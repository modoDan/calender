<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<title>日历</title>
		<style type="text/css">
			* {
				box-sizing: border-box;
			}
			
			ul {
				list-style-type: none;
			}
			
			body {
				font-family: Verdana, sans-serif;
				background: #E8F0F3;
			}
			
			#calendar {
				width: 80%;
				box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 3px 1px -2px rgba(0, 0, 0, 0.1), 0 1px 5px 0 rgba(0, 0, 0, 0.12);
			}
			
			.month {
				width: 100%;
				background: #00B8EC;
			}
			
			.month ul {
				margin: 0;
				padding: 0;
				display: flex;
				justify-content: space-between;
			}
			
			.year-month {
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: space-around;
			}
			
			.year-month:hover {
				background: rgba(150, 2, 12, 0.1);
			}
			
			.choose-year {
				padding-left: 20px;
				padding-right: 20px;
			}
			
			.choose-month {
				text-align: center;
				font-size: 1.5rem;
			}
			
			.arrow {
				padding: 30px;
			}
			
			.arrow:hover {
				background: rgba(100, 2, 12, 0.1);
			}
			
			.month ul li {
				color: white;
				font-size: 20px;
				text-transform: uppercase;
				letter-spacing: 3px;
			}
			
			.weekdays {
				margin: 0;
				padding: 10px 0;
				background-color: #00B8EC;
				display: flex;
				flex-wrap: wrap;
				color: #FFFFFF;
				justify-content: space-around;
			}
			
			.weekdays li {
				display: inline-block;
				width: 13.6%;
				text-align: center;
			}
			
			.days {
				padding: 0;
				background: #FFFFFF;
				margin: 0;
				display: flex;
				flex-wrap: wrap;
			}
			
			.days li {
				list-style-type: none;
				display: inline-block;
				width: 14.2%;
				text-align: center;
				padding-bottom: 15px;
				padding-top: 15px;
				font-size: 1rem;
				color: #000;
			}
			
			.days li .active {
				padding: 6px 10px;
				border-radius: 50%;
				background: #00B8EC;
				color: #fff;
			}
			
			.days li .other-month {
				padding: 5px;
				color: gainsboro;
			}
			.days li span:after {
				content:'√'
			}
			
			.months li{
			    width: 25%;
			}
			.years li{
			    width: 25%;
			}
			.weeks li{
			    width: 20%;
			}
			.quarters li{
			    width: 50%;
			}
		</style>
	</head>

	<body>
		<div id="vue-calendar" class="vue-calendar-picker">
			<div id="date-text" class="active" :class="{ 'visible':showMenu }" @click="openMenu"><span v-if="eventType == 'text'">{{dateText}}</span><button v-else>按钮</button></div>
			<div id="calendar" :type="dateType" :class="menuClass" :style="menuStyle">
				<div class="month">
					<ul>
						<li class="arrow" @click="pickPre(currentYear,currentMonth,1)" v-if="dateType=='day'">❮</li>
						<li class="arrow" @click="pickPre(starYear,currentMonth)" v-if="dateType=='year'">❮</li>
						<li class="arrow" @click="pickPre(currentYear,currentMonth)" v-else>❮</li>
						<li class="year-month" @click="pickYear(currentYear,currentMonth)">
							<span class="choose-year" v-if="dateType=='year'">{{ rangYear }}</span>
							<span class="choose-year" v-else>{{ currentYear }}年</span>
							<span class="choose-month" v-if="dateType=='day'">{{ currentMonth }}月</span>
						</li>
						<li class="arrow" @click="pickNext(starYear,currentMonth)" v-if="dateType=='year'">❯</li>
						<li class="arrow" @click="pickNext(currentYear,currentMonth)" v-else>❯</li>
						<li class="arrow" @click="pickNext(currentYear,currentMonth,1)" v-if="dateType=='day'">❯</li>
					</ul>
				</div>
				<ul class="weekdays" v-if="dateType=='day'">
					<li>一</li>
					<li>二</li>
					<li>三</li>
					<li>四</li>
					<li>五</li>
					<li>六</li>
					<li>日</li>
				</ul>
				<ul class="days" v-if="dateType=='day'">
					<li @click="pick(day)" v-for="day in days">
						<!--其他月-->
						<span v-if="day.getMonth()+1 != currentMonth" class="other-month">{{ day.getDate() }}</span>
						<span v-else>
   						<!--今天-->
   							<span v-if="day.getFullYear() == new Date().getFullYear() && day.getMonth() == new Date().getMonth() && day.getDate() == new Date().getDate()" class="active">{{ day.getDate() }}</span>
						<span v-else>{{ day.getDate() }}</span>
						</span>
					</li>
				</ul>
				<ul class="days" v-if="dateType=='month'" :class="'months'">
					<li @click="pick(month)" v-for="month in months">
						<span  v-if="month.getFullYear() == new Date().getFullYear() && month.getMonth() == new Date().getMonth() && month.getDate() == new Date().getDate()" class="active">{{ month.getMonth()+1 }}</span>
						<span v-else class="other-month">{{ month.getMonth()+1 }}</span>
					</li>
				</ul>
				<ul class="days" v-if="dateType=='quarter'" :class="'quarters'">
					<li @click="pick(quarter)" v-for="quarter in quarters" v-if="dateType=='quarter'">
						<span  v-if="quarter.getFullYear() == new Date().getFullYear() && quarter.getMonth() == new Date().getMonth() && quarter.getDate() == new Date().getDate()" class="active">{{ Math.floor((quarter.getMonth() + 3) / 3) }}</span>
						<span v-else class="other-month">{{ Math.floor((quarter.getMonth() + 3) / 3) }}</span>
					</li>
				</ul>
				<ul class="days" v-if="dateType=='week'" :class="'weeks'">
					<li @click="pick(week)" v-for="week in weeks" v-if="dateType=='week'">
						<span class="other-month">{{getweeks(week)}}</span>
					</li>
				</ul>
				<ul class="days" v-if="dateType=='year'" :class="'years'">
					<li @click="pick(year)" v-for="year in years" v-if="dateType=='year'">
						<span v-if="year.getFullYear() == new Date().getFullYear() && year.getMonth() == new Date().getMonth() && year.getDate() == new Date().getDate()" class="active">{{ year.getFullYear() }}</span>
						<span v-else class="other-month">{{ year.getFullYear() }}</span>
					</li>
				</ul>
			</div>
		</div>
		<script src="http://cdnjs.cloudflare.com/ajax/libs/vue/1.0.18/vue.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
		<script type="text/javascript">
			new Vue({
				el: '#vue-calendar',
				data: {
					currentDay: 1,
					currentMonth: 1,
					currentYear: 1970,
					currentWeek: 1,
					days: [],
					weeks: [],
					years: [],
					months: [],
					quarters: [],
					rangYear: '1970年-1979年',
					starYear: '1970年',
					starWeek: '',
					endWeek: '',
					beforeWeekNum: 1,
					turnType: null,
					showMenu: false,
					now: new Date(),
					curNow: new Date(),
				},
				props: {
					'dateType': {
						type: String,
						default: 'month'
					},
					'eventType': {
						type: String,
						default: 'text'
					},
					'value': {
						default: null
					},
					dataLabels: {
						type: Array,
						default: function() { //月份
							return ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12']
						}
					},
				},
				computed: {
					menuClass() {
						return {
							visible: this.showMenu,
							hidden: !this.showMenu
						}
					},
					menuStyle() {
						return {
							display: this.showMenu ? 'block' : 'none'
						}
					},
					dateText() {
						let valueMoment = this.curNow
						if(this.dateType == 'year') { //年
							return this.format(valueMoment.getFullYear())
						} else if(this.dateType == 'month') { //月份
							return this.format(valueMoment.getFullYear(), valueMoment.getMonth() + 1)
						} else if(this.dateType == 'day') { //天
							return this.format(valueMoment.getFullYear(), valueMoment.getMonth() + 1, valueMoment.getDate())
						} else if(this.dateType == 'quarter') { //季度
							return this.format(valueMoment.getFullYear(), Math.floor((valueMoment.getMonth() + 3) / 3))
						} else if(this.dateType == 'week') { //周
							return this.getRangeWeek
						}
					},
					getRangeWeek() {
						var currentDate = this.curNow;
						var week = currentDate.getDay();
						var millisecond = 1000 * 60 * 60 * 24;
						var minusDay = week != 0 ? week - 1 : 6;
						var monday = new Date(currentDate.getTime() - (minusDay * millisecond));
						var sunday = new Date(monday.getTime() + (6 * millisecond));
						var s_week = this.format('', monday.getMonth() + 1, monday.getDate())
						var e_week = this.format('', sunday.getMonth() + 1, sunday.getDate())
						return s_week + '-' + e_week;
					},
					getCurrentWeek() {
						var startStop = [];
						var currentDate = this.now;
						//返回date是一周中的某一天    
						var week = currentDate.getDay();
						//一天的毫秒数    
						var millisecond = 1000 * 60 * 60 * 24;
						//减去的天数    
						var minusDay = week != 0 ? week - 1 : 6;
						var monday = new Date(currentDate.getTime() - (minusDay * millisecond));
						var sunday = new Date(monday.getTime() + (6 * millisecond));
						startStop.push(monday); //本周起始时间    
						startStop.push(sunday); //本周终止时间  
						return startStop;
					},
				},
				created: function() {
					this.initData(null);
					this.init()
				},
				mounted() {
					//					this.init()
				},
				methods: {
					getYearWeek(date) { //获取当年第几周
						var date2 = new Date(date.getFullYear(), 0, 1);
						var day1 = date.getDay();
						if(day1 == 0) day1 = 7;
						var day2 = date2.getDay();
						if(day2 == 0) day2 = 7;
						d = Math.round((date.getTime() - date2.getTime() + (day2 - day1) * (24 * 60 * 60 * 1000)) / 86400000);
						return Math.floor(d / 7) + 1;
					},
					getweeks(d) {
						var e_week = this.format('', d.getMonth() + 1, d.getDate())
						if(d.getDate() > 6) {
							var s_week = this.format('', d.getMonth() + 1, d.getDate() - 6)
						} else {
							d.setDate(d.getDate() - 6)
							var s_week = this.format('', d.getMonth() + 1, d.getDate())
						}
						return s_week + '-' + e_week
					},
					init() {
						document.addEventListener('click', (e) => {
							if(this.$el && !this.$el.contains(e.target)) {
								this.closeMenu()
							}
						}, false)
					},
					openMenu() {
						this.curNow = new Date()
						this.initData(null);
						this.showMenu = true
					},
					closeMenu() {
						this.showMenu = false
					},
					initData: function(cur) {
						var date;
						if(cur) {
							date = new Date(cur);
						} else {
							date = new Date();
						}
						this.currentDay = date.getDate();
						this.currentYear = date.getFullYear();
						this.currentMonth = date.getMonth() + 1;
						this.currentQuarter = Math.floor((date.getMonth() + 3) / 3);
						this.currentWeek = date.getDay(); // 1...6,0
						if(this.currentWeek == 0) {
							this.currentWeek = 7;
						}
						var str = this.formatDate(this.currentYear, this.currentMonth, this.currentDay);
						console.log("today:" + str + "," + this.currentWeek + "," + this.currentQuarter);
						if(this.dateType == 'day') {
							this.days.length = 0;
							for(var i = this.currentWeek - 1; i >= 0; i--) {
								var d = new Date(str);
								d.setDate(d.getDate() - i);
								this.days.push(d);
							}
							for(var i = 1; i <= 35 - this.currentWeek; i++) {
								var d = new Date(str);
								d.setDate(d.getDate() + i);
								this.days.push(d);
							}
						} else if(this.dateType == 'month') {
							this.months.length = 0;
							for(var i = this.currentMonth - 1; i >= 0; i--) {
								var d = new Date(str);
								d.setMonth(d.getMonth() - i);
								var mon = d.getMonth() + 1;
								this.months.push(d);
							}
							for(var i = 1; i <= 12 - this.currentMonth; i++) {
								var d = new Date(str);
								d.setMonth(d.getMonth() + i);
								this.months.push(d);
							}
						} else if(this.dateType == 'quarter') {
							this.quarters.length = 0;
							for(var i = this.currentQuarter - 1; i >= 0; i--) {
								var d = new Date(str);
								d.setMonth(((d.getMonth() - 3 * i) - i));
								this.quarters.push(d);
							}
							for(var i = 1; i <= 4 - this.currentQuarter; i++) {
								var d = new Date(str);
								d.setMonth(((d.getMonth() + 3 / i) + i));
								this.quarters.push(d);
							}
							this.quarters.sort(function(a, b) {
								return a - b
							});
						} else if(this.dateType == 'year') {
							this.years.length = 0;
							this.currentYear = moment(date).format('YY');
							if(this.currentYear < 10) { //00-09年期间
								for(var i = 0; i < 10 - this.currentYear; i++) {
									var d = new Date(str);
									d.setFullYear(d.getFullYear() + 1 * i, d.getMonth() + 1, 1);
									this.years.push(d);
								}
							} else if(this.currentYear > 10 && this.currentYear < 20) { //10-20年期间
								for(var i = this.currentYear - 10; i >= 0; i--) {
									var d = new Date(str);
									d.setFullYear(d.getFullYear() - 1 * i, d.getMonth() + 1, 1);
									this.years.push(d);
								}
								for(var i = 1; i < 10 - (this.currentYear - 10); i++) {
									var d = new Date(str);
									d.setFullYear(d.getFullYear() + 1 * i, d.getMonth() + 1, 1);
									this.years.push(d);
								}
							} else { //20年以后
								for(var i = (this.currentYear - 10) % 10; i >= 0; i--) {
									var d = new Date(str);
									d.setFullYear(d.getFullYear() - 1 * i, d.getMonth() + 1, 1);
									this.years.push(d);
								}
								for(var i = 1; i < 10 - (this.currentYear - 10) % 10; i++) {
									var d = new Date(str);
									d.setFullYear(d.getFullYear() + 1 * i, d.getMonth() + 1, 1);
									this.years.push(d);
								}
							}
							this.rangYear = this.years[0].getFullYear() + '年-' + this.years[9].getFullYear() + '年'
							this.starYear = this.years[0].getFullYear()
						} else if(this.dateType == 'week') {
							this.weeks.length = 0;
							this.currentWeekNum = this.getYearWeek(date)
							if(!this.turnType) {
								if(this.currentWeekNum < 20) {
									for(var i = this.currentWeekNum - 1; i > 0; i--) {
										this.now = new Date(str);
										var d = new Date(this.getCurrentWeek[1]);
										d.setDate(d.getDate() - 7 * i);
										this.weeks.push(d);
									}
									for(var i = 1; i <= 20 - this.currentWeekNum; i++) {
										this.now = new Date(str);
										var d = new Date(this.getCurrentWeek[1]);
										d.setDate(d.getDate() + 7 * i);
										this.weeks.push(d);
									}
								} else if(this.currentWeekNum > 20 && this.currentWeekNum < 40) {
									for(var i = this.currentWeekNum - 20 - 1; i >= 0; i--) {
										this.now = new Date(str);
										var d = new Date(this.getCurrentWeek[1]);
										d.setDate(d.getDate() - 7 * i);
										this.weeks.push(d);
									}
									for(var i = 1; i <= 20 - (this.currentWeekNum - 20); i++) {
										this.now = new Date(str);
										var d = new Date(this.getCurrentWeek[1]);
										d.setDate(d.getDate() + 7 * i);
										this.weeks.push(d);
									}
								} else {
									for(var i = this.currentWeekNum - 40 - 1; i >= 0; i--) {
										this.now = new Date(str);
										var d = new Date(this.getCurrentWeek[1]);
										d.setDate(d.getDate() - 7 * i);
										this.weeks.push(d);
									}
									for(var i = 1; i <= 20 - (this.currentWeekNum - 40); i++) {
										this.now = new Date(str);
										var d = new Date(this.getCurrentWeek[1]);
										d.setDate(d.getDate() + 7 * i);
										this.weeks.push(d);
									}
								}
							} else if(this.turnType == -1) { //向前翻
								if(this.starWeek > this.currentWeekNum) {
									for(var i = 20 - (this.starWeek - this.currentWeekNum); i >= 0; i--) { //不包括自己33
										this.now = new Date(str);
										var d = new Date(this.getCurrentWeek[1]); //每个周的起始日期开始
										d.setDate(d.getDate() - 7 * i);
										this.weeks.push(d);
									}
									for(var i = 1; i <= this.starWeek - this.currentWeekNum - 1; i++) {
										this.now = new Date(str);
										var d = new Date(this.getCurrentWeek[1]);
										d.setDate(d.getDate() + 7 * i);
										this.weeks.push(d);
									}
								} else {
									var totalweek = 20 - this.beforeWeekNum + this.currentWeekNum; //前一年一共多少周
									console.log(totalweek)
									this.starWeek = this.starWeek + totalweek
									for(var i = 20 - (this.starWeek - this.currentWeekNum); i >= 0; i--) { //不包括自己33
										this.now = new Date(str);
										var d = new Date(this.getCurrentWeek[1]); //每个周的起始日期开始
										d.setDate(d.getDate() - 7 * i);
										this.weeks.push(d);
									}
									for(var i = 1; i <= this.starWeek - this.currentWeekNum - 1; i++) {
										this.now = new Date(str);
										var d = new Date(this.getCurrentWeek[1]);
										d.setDate(d.getDate() + 7 * i);
										this.weeks.push(d);
									}
								}

							} else { //向后翻
								if(this.endWeek < this.currentWeekNum) {
									for(var i = this.currentWeekNum - this.endWeek - 1; i > 0; i--) { //不包括自己33
										this.now = new Date(str);
										var d = new Date(this.getCurrentWeek[1]); //每个周的起始日期开始
										d.setDate(d.getDate() - 7 * i);
										this.weeks.push(d);
									}
									for(var i = 0; i <= 20 - (this.currentWeekNum - this.endWeek); i++) {
										this.now = new Date(str);
										var d = new Date(this.getCurrentWeek[1]);
										d.setDate(d.getDate() + 7 * i);
										this.weeks.push(d);
									}
								} else {
									var totalweek = 20 - this.currentWeekNum + this.beforeWeekNum; //前一年一共多少周
									console.log(totalweek)
									this.currentWeekNum = this.currentWeekNum + totalweek
									for(var i = this.currentWeekNum - this.endWeek - 1; i >= 0; i--) { //不包括自己33
										this.now = new Date(str);
										var d = new Date(this.getCurrentWeek[1]); //每个周的起始日期开始
										d.setDate(d.getDate() - 7 * i);
										this.weeks.push(d);
									}
									for(var i = 1; i <= 20 - (this.currentWeekNum - this.endWeek); i++) {
										this.now = new Date(str);
										var d = new Date(this.getCurrentWeek[1]);
										d.setDate(d.getDate() + 7 * i);
										this.weeks.push(d);
									}
								}
							}
							this.starWeek = this.getYearWeek(this.weeks[0])
							this.endWeek = this.getYearWeek(this.weeks[this.weeks.length - 1])
							this.beforeWeekNum = this.getYearWeek(date)
						}
					},
					pick: function(date) {
						if(this.eventType == 'text') {
							this.curNow = date
							this.closeMenu()
						} else {
							console.log(moment(date).format('YYYY年MM月DD日'))
						}
					},
					pickPre: function(year, month, type) {
						// setDate(0); 上月最后一天
						// setDate(-1); 上月倒数第二天
						// setDate(dx) 参数dx为 上月最后一天的前后dx天
						if(type == 1) { //日历年切换
							var d = new Date(this.formatDate(year, month, 1));
							this.initData(this.formatDate(d.getFullYear() - 1, d.getMonth() + 1, 1));
						} else {
							if(this.dateType == 'day') { //日历月份切换
								var d = new Date(this.formatDate(year, month, 1));
								d.setDate(0);
								this.initData(this.formatDate(d.getFullYear(), d.getMonth() + 1, 1));
							} else if(this.dateType == 'month' || this.dateType == 'quarter') { //月度/季度日历切换
								var d = new Date(this.formatDate(year, month, 1));
								this.initData(this.formatDate(d.getFullYear() - 1, d.getMonth() + 1, 1));
							} else if(this.dateType == 'year') {
								var d = new Date(this.formatDate(year, month, 1));
								this.initData(this.formatDate(d.getFullYear() - 10, d.getMonth() + 1, 1));
							} else if(this.dateType == 'week') {
								this.turnType = -1
								var d = new Date(this.getCurrentWeek[1]);
								d.setDate(this.getCurrentWeek[1].getDate() - 20 * 7);
								this.initData(this.formatDate(d.getFullYear(), d.getMonth() + 1, d.getDate()));
							}
						}
					},
					pickNext: function(year, month, type) {
						if(type == 1) {
							var d = new Date(this.formatDate(year, month, 1));
							this.initData(this.formatDate(d.getFullYear() + 1, d.getMonth() + 1, 1));
						} else {
							if(this.dateType == 'day') {
								var d = new Date(this.formatDate(year, month, 1));
								d.setDate(35);
								this.initData(this.formatDate(d.getFullYear(), d.getMonth() + 1, 1));
							} else if(this.dateType == 'month' || this.dateType == 'quarter') {
								var d = new Date(this.formatDate(year, month, 1));
								this.initData(this.formatDate(d.getFullYear() + 1, d.getMonth() + 1, 1));
							} else if(this.dateType == 'year') {
								var d = new Date(this.formatDate(year, month, 1));
								this.initData(this.formatDate(d.getFullYear() + 10, d.getMonth() + 1, 1));
							} else if(this.dateType == 'week') {
								this.turnType = 1
								var d = new Date(this.getCurrentWeek[1]);
								d.setDate(this.getCurrentWeek[1].getDate() + 20 * 7);
								this.initData(this.formatDate(d.getFullYear(), d.getMonth() + 1, d.getDate()));
							}
						}
					},
					pickYear: function(year, month) {
						alert(year + "," + month);
					},

					// 返回 类似 2016-01-02 格式的字符串
					formatDate: function(year, month, day) {
						var y = year;
						var m = month;
						if(m < 10) m = "0" + m;
						var d = day;
						if(d < 10) d = "0" + d;
						return y + "-" + m + "-" + d
					},
					format: function(year, month, day) {
						var y = year;
						var m = month;
						var d = day;
						if(y && m && d) {
							return y + "年" + m + "月" + d + "日"
						} else if(m && !d && this.dateType == "month") {
							return y + "年" + m + "月"
						} else if(this.dateType == "quarter") {
							return y + "年第" + m + "季度"
						} else if(y && !m && !d) {
							return y + "年"
						} else if(!y) {
							return m + "月" + d + "日"
						}

					},
					splitArry: function(arr, len) {
						var a_len = arr.length;
						var result = [];
						for(var i = 0; i < a_len; i += len) {
							result.push(arr.slice(i, i + len));
						}
						return result;
						/*用法
						 * var splitArry = this.splitArry(this.days, 7)
						for(var i = 0; i < splitArry.length; i++) {
							var s_len = splitArry[i].length
							for(var j = 0; j < s_len; j++) {
								var s_week = this.format('', splitArry[i][0].getMonth() + 1, splitArry[i][0].getDate())
								var e_week = this.format('', splitArry[i][s_len - 1].getMonth() + 1, splitArry[i][s_len - 1].getDate())
							}
							this.weeks.push(s_week + '-' + e_week);
						}*/
					},
				},
			});
		</script>
	</body>

</html>